image: golang:1.24.1

stages:
  - install
  - test
  - build

# 1ï¸âƒ£ Install dependencies
install_dependencies:
  stage: install
  script:
    - echo "ğŸ“¦ Installing dependencies..."
    - go mod download
    - go mod verify
  cache:
    key: "gomod-cache"
    paths:
      - /go/pkg/mod
  artifacts:
    paths:
      - go.sum
      - go.mod

# 2ï¸âƒ£ Run tests
run_tests:
  stage: test
  script:
    - echo "ğŸ§ª Running tests..."
    - go test ./... -v -cover
  artifacts:
    when: always
    reports:
      junit: junit.xml

# 3ï¸âƒ£ Build the binary
build_app:
  stage: build
  script:
    - echo "ğŸ—ï¸ Building the application..."
    - go build -v -o app ./...
  artifacts:
    paths:
      - app
